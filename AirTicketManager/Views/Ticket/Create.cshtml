@model AirTicketEntittes.TicketViewModel

@{
    Layout = "_Layout";
}

<body>
    <div class="form-container">
        <h2>Create New Ticket</h2>
        <form id="createTicketForm" method="POST" asp-controller="Ticket" asp-action="Create">
            <div class="form-group">
                <label for="PassengerName">Passenger Name</label>
                <input type="text" id="PassengerName" name="PassengerName" />
            </div>

            <div class="form-group">
                <label for="DepartureDate">Departure Date and Time</label>
                <input type="date" id="DepartureDate" name="DepartureDate" />
            </div>

            <div class="form-group">
                <label for="ArrivalDate">Arrival Date and Time</label>
                <input type="date" id="ArrivalDate" name="ArrivalDate" />
            </div>

            <div class="form-group">
                <label for="TicketPrice">Ticket Price</label>
                <input type="number" id="TicketPrice" name="TicketPrice" />
            </div>

            <div class="form-group">
                <label for="PriorityId">Priority</label>
                <select id="PriorityId" name="PriorityId" class="select-box">
                    @foreach (var item in Model.AvailablePriorites)
                    {
                        <option value="@item.Value">@item.Text</option>
                    }
                </select>
            </div>

            <div class="form-group">
                <label for="LebelId">Lebel</label>
                <select id="LebelId" name="LebelId" class="select-box">
                    <option value="">Select Lebel</option>
                    <!-- The options will be populated via AJAX -->
                </select>
            </div>

            <div class="form-group">
                <button type="button" id="submitTicket" class="submit-btn">Create Ticket</button> <!-- Change button type to button -->
                <a href="@Url.Action("Index", "Home")" class="submit-btn cancel-btn">Cancel</a>
            </div>
        </form>

        <div class="form-footer">
            <p>© 2024 Your Company</p>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

     <script>
            // Function to fetch Lebel options and populate the dropdown
            function fetchLebels() {
                $.ajax({
                    url: '@Url.Action("GetLebels", "Ticket")', // Your controller action URL
                    type: 'GET',
                    success: function (data) {
                        $('#LebelId').empty();
                        $('#LebelId').append('<option value="">Select Lebel</option>'); // Add default option

                        // Populate the Lebel dropdown
                        $.each(data, function (index, item) {
                            $('#LebelId').append('<option value="' + item.value + '">' + item.text + '</option>');
                        });
                    },
                    error: function () {
                        alert('Error loading Lebel data.');
                    }
                });
            }

        // Function to handle the form submission via AJAX
        function submitTicketForm() {
            // Create the ViewModel object using form data
            var formData = {
                PassengerName: $('#PassengerName').val(),
                DepartureDate: $('#DepartureDate').val(),
                ArrivalDate: $('#ArrivalDate').val(),
                TicketPrice: $('#TicketPrice').val(),
                PriorityId: $('#PriorityId').val(),
                LebelId: $('#LebelId').val() // Add the LebelId from the select box
            };
            // Send the AJAX request to submit the form
            $.ajax({
                url: '@Url.Action("CreateTicketAjax", "Ticket")', // Your controller action URL
                type: 'POST',
                data: JSON.stringify(formData), // Send the ViewModel as JSON
                contentType: 'application/json', // Set content type as JSON
                success: function (response) {
                    if (response.success) {
                        alert(response.message); // Success message
                        window.location.href = '@Url.Action("Index", "Home")'; // Redirect to another page (e.g., home page)
                    } else {
                        alert(response.message); // Error message
                    }
                },
                error: function () {
                    alert('An error occurred while submitting the form.');
                }
            });
        }

        // When the page is loaded, fetch Lebel options and handle the form submission
        $(document).ready(function () {
            // Fetch Lebel options when the page loads
            fetchLebels();

            // Handle form submission when the "Create Ticket" button is clicked
            $('#submitTicket').on('click', function (e) {
                e.preventDefault(); // Prevent the default form submission
                submitTicketForm(); // Call the function to submit the form via AJAX
            });
        });
    </script>
</body>
